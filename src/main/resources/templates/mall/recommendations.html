
<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Recommendations - Sales Mall</title>
<!--    <link rel="stylesheet" th:href="@{/mall/css/bootstrap.min.css}">-->
<!--    <link rel="stylesheet" th:href="@{/mall/styles/common.css}">-->
    <link rel="stylesheet" th:href="@{/mall/styles/search.css}">
<!--    <link rel="stylesheet" th:href="@{/mall/styles/footer.css}">-->
    <link rel="stylesheet" th:href="@{/mall/styles/header.css}" />
    <link rel="stylesheet" th:href="@{/mall/styles/recommendations.css}" />
</head>
<body>
<div th:replace="~{mall/header :: header}"></div>

<div class="container" style="min-height: 550px; margin-top: 50px;">
    <div class="row">
        <div class="col-12">
            <h2 class="mb-4">Recommended For You</h2>
            <p class="text-muted">Based on your purchase history</p>
        </div>
    </div>

    <div class="row mt-4" id="recommendations-container">
        <div class="col-12 text-center">
            <div class="spinner-border text-primary" role="status">
                <span class="sr-only">Loading...</span>
            </div>
            <p class="mt-2">Loading recommendations...</p>
        </div>
    </div>
</div>

<div th:replace="~{mall/footer :: footer-fragment}"></div>

<script th:src="@{/mall/js/jquery-1.8.0.js}"></script>
<script th:src="@{/mall/js/bootstrap3.js}"></script>
<script>
    $(function() {
        loadRecommendations();
    });

    function loadRecommendations() {
        $.ajax({
            type: 'GET',
            url: '/api/recommendations',
            data: { limit: 12 },
            success: function(result) {
                if (result.resultCode == 200) {
                    displayRecommendations(result.data);
                } else {
                    $('#recommendations-container').html(
                        '<div class="col-12 text-center">' +
                        '<p class="text-muted">' + result.message + '</p>' +
                        '<p>Start shopping to get personalized recommendations!</p>' +
                        '<a href="/index" class="btn btn-primary">Browse Products</a>' +
                        '</div>'
                    );
                }
            },
            error: function() {
                $('#recommendations-container').html(
                    '<div class="col-12 text-center">' +
                    '<p class="text-danger">Failed to load recommendations</p>' +
                    '</div>'
                );
            }
        });
    }

    function displayRecommendations(goods) {
        if (!goods || goods.length === 0) {
            $('#recommendations-container').html(
                '<div class="col-12 text-center">' +
                '<p class="text-muted">No recommendations available yet</p>' +
                '</div>'
            );
            return;
        }

        var html = '';
        for (var i = 0; i < goods.length; i++) {
            var item = goods[i];
            html += '<div class="col-lg-3 col-md-4 col-sm-6 mb-4">' +
                '<div class="card h-100">' +
                '<a href="/goods/detail/' + item.goodsId + '">' +
                '<img class="card-img-top" src="' + item.goodsCoverImg + '" alt="' + item.goodsName + '">' +
                '</a>' +
                '<div class="card-body">' +
                '<h5 class="card-title">' +
                '<a href="/goods/detail/' + item.goodsId + '">' + item.goodsName + '</a>' +
                '</h5>' +
                '<p class="card-text text-muted">' + item.goodsIntro + '</p>' +
                '<p class="card-text text-danger font-weight-bold">$' + item.sellingPrice + '</p>' +
                '</div>' +
                '</div>' +
                '</div>';
        }
        $('#recommendations-container').html(html);
    }
</script>
</body>
</html>